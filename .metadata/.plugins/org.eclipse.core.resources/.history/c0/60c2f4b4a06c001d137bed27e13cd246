package pages;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import pojos.Course;
import pojos.Student;

@WebServlet("/process_admission")
public class ProcessAdmissionForm extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		response.setContentType("text/html");
		try (PrintWriter pw = response.getWriter()) {
			// 1. read req params
			String firstName = request.getParameter("fn");
			String lastName = request.getParameter("ln");
//			Courser is Enum and valueOf Is Method
			Course course = Course.valueOf(request.getParameter("course").toUpperCase());
			int score = Integer.parseInt(request.getParameter("score"));
			// create student object
			Student student = new Student(firstName, lastName, course, score);
			// since using server pull : req dispatching --min scope reqd = request scope
			request.setAttribute("student_dtls", student);
			pw.print("<h4>from 1st page ......</h4>");		// Content are Added To Pw's Buffer
//			pw.flush();	// Flush is Committing the Output (print) If Flushed it will 

			// validation
			if (student.getScore() >= course.getMinScore())
				student.setAdmissionStatus(true);
			// Navigate the clnt to --> results page in the SAME request
			// 1. Get RD object
			//	This will go to next page
			RequestDispatcher rd = request.getRequestDispatcher("results");
			System.out.println("rd " + rd.getClass());// impl class server provided
			rd.forward(request, response);// IllegalStateExc : can not call forward after commititng the resp !
			// WC : suspends exec of this method --clrs resp buffer --invokes doPost method
			// of the ResultPage
			System.out.println("control came back.....");
		}
	}

}
